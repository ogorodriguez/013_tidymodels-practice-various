<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="LJ" />

<meta name="date" content="2023-01-21" />

<title>Tidymodels: Tidy Machine Learning in R</title>

<script src="site_libs/header-attrs-2.18/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<link rel="icon" href="https://github.com/workflowr/workflowr-assets/raw/main/img/reproducible.png">
<!-- Add a small amount of space between sections. -->
<style type="text/css">
div.section {
  padding-top: 12px;
}
</style>



<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Tidymodels Learning from Various Sites</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About</a>
</li>
<li>
  <a href="license.html">License</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/ogorodriguez/013_tidymodels-practice-various">
    <span class="fab fa-github"></span>
     
    Source code
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Tidymodels: Tidy Machine Learning in R</h1>
<h4 class="author">LJ</h4>
<h4 class="date">2023-01-21</h4>

</div>


<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-report" data-toggle="collapse" data-target="#workflowr-report">
<span class="glyphicon glyphicon-list" aria-hidden="true"></span>
workflowr <span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span>
</button>
</p>
<div id="workflowr-report" class="collapse">
<ul class="nav nav-tabs">
<li class="active">
<a data-toggle="tab" href="#summary">Summary</a>
</li>
<li>
<a data-toggle="tab" href="#checks"> Checks <span
class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> </a>
</li>
<li>
<a data-toggle="tab" href="#versions">Past versions</a>
</li>
</ul>
<div class="tab-content">
<div id="summary" class="tab-pane fade in active">
<p>
<strong>Last updated:</strong> 2023-01-29
</p>
<p>
<strong>Checks:</strong> <span
class="glyphicon glyphicon-ok text-success" aria-hidden="true"></span> 6
<span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> 1
</p>
<p>
<strong>Knit directory:</strong>
<code>013_tidymodels-practice-various/</code> <span
class="glyphicon glyphicon-question-sign" aria-hidden="true"
title="This is the local directory in which the code in this file was executed.">
</span>
</p>
<p>
This reproducible <a href="https://rmarkdown.rstudio.com">R Markdown</a>
analysis was created with <a
  href="https://github.com/workflowr/workflowr">workflowr</a> (version
1.7.0). The <em>Checks</em> tab describes the reproducibility checks
that were applied when the results were created. The <em>Past
versions</em> tab lists the development history.
</p>
<hr>
</div>
<div id="checks" class="tab-pane fade">
<div id="workflowr-checks" class="panel-group">
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRMarkdownfilestronguptodate">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>R Markdown file:</strong> up-to-date
</a>
</p>
</div>
<div id="strongRMarkdownfilestronguptodate"
class="panel-collapse collapse">
<div class="panel-body">
<p>Great! Since the R Markdown file has been committed to the Git
repository, you know the exact version of the code that produced these
results.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongEnvironmentstrongempty">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Environment:</strong> empty </a>
</p>
</div>
<div id="strongEnvironmentstrongempty" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! The global environment was empty. Objects defined in the
global environment can affect the analysis in your R Markdown file in
unknown ways. For reproduciblity it’s best to always run the code in an
empty environment.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSeedstrongcodesetseed20230106code">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Seed:</strong>
<code>set.seed(20230106)</code> </a>
</p>
</div>
<div id="strongSeedstrongcodesetseed20230106code"
class="panel-collapse collapse">
<div class="panel-body">
<p>The command <code>set.seed(20230106)</code> was run prior to running
the code in the R Markdown file. Setting a seed ensures that any results
that rely on randomness, e.g. subsampling or permutations, are
reproducible.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongSessioninformationstrongrecorded">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Session information:</strong>
recorded </a>
</p>
</div>
<div id="strongSessioninformationstrongrecorded"
class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Recording the operating system, R version, and package
versions is critical for reproducibility.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongCachestrongdetected">
<span class="glyphicon glyphicon-exclamation-sign text-danger"
aria-hidden="true"></span> <strong>Cache:</strong> detected </a>
</p>
</div>
<div id="strongCachestrongdetected" class="panel-collapse collapse">
<div class="panel-body">
The following chunks had caches available:
<ul>
<li>
checking distibution of variable mass
</li>
<li>
checking distibution of variable tricep
</li>
<li>
data cleaning replace 0s with NAs
</li>
<li>
loading the packages
</li>
<li>
rename and visualize the dataset
</li>
<li>
session-info-chunk-inserted-by-workflowr
</li>
<li>
unnamed-chunk-1
</li>
<li>
unnamed-chunk-2
</li>
<li>
view a random subset of the data
</li>
<li>
view a summary of the data
</li>
</ul>
<p>To ensure reproducibility of the results, delete the cache directory
<code>02_tidymodels-tidy-machine-learning_cache</code> and re-run the
analysis. To have workflowr automatically delete the cache directory
prior to building the file, set <code>delete_cache = TRUE</code> when
running <code>wflow_build()</code> or <code>wflow_publish()</code>.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongFilepathsstrongrelative">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>File paths:</strong> relative </a>
</p>
</div>
<div id="strongFilepathsstrongrelative" class="panel-collapse collapse">
<div class="panel-body">
<p>Great job! Using relative paths to the files within your workflowr
project makes it easier to run your code on other machines.</p>
</div>
</div>
</div>
<div class="panel panel-default">
<div class="panel-heading">
<p class="panel-title">
<a data-toggle="collapse" data-parent="#workflowr-checks" href="#strongRepositoryversionstrongahrefhttpsgithubcomogorodriguez013tidymodelspracticevarioustree7c15045931b33f08d6c3ea20f4902e76273d208etargetblank7c15045a">
<span class="glyphicon glyphicon-ok text-success"
aria-hidden="true"></span> <strong>Repository version:</strong>
<a href="https://github.com/ogorodriguez/013_tidymodels-practice-various/tree/7c15045931b33f08d6c3ea20f4902e76273d208e" target="_blank">7c15045</a>
</a>
</p>
</div>
<div
id="strongRepositoryversionstrongahrefhttpsgithubcomogorodriguez013tidymodelspracticevarioustree7c15045931b33f08d6c3ea20f4902e76273d208etargetblank7c15045a"
class="panel-collapse collapse">
<div class="panel-body">
<p>
Great! You are using Git for version control. Tracking code development
and connecting the code version to the results is critical for
reproducibility.
</p>
<p>
The results in this page were generated with repository version
<a href="https://github.com/ogorodriguez/013_tidymodels-practice-various/tree/7c15045931b33f08d6c3ea20f4902e76273d208e" target="_blank">7c15045</a>.
See the <em>Past versions</em> tab to see a history of the changes made
to the R Markdown and HTML files.
</p>
<p>
Note that you need to be careful to ensure that all relevant files for
the analysis have been committed to Git prior to generating the results
(you can use <code>wflow_publish</code> or
<code>wflow_git_commit</code>). workflowr only checks the R Markdown
file, but you know if there are other scripts or data files that it
depends on. Below is the status of the Git repository when the results
were generated:
</p>
<pre><code>
Ignored files:
    Ignored:    .Rhistory
    Ignored:    .Rproj.user/
    Ignored:    analysis/01_classification-tidymodels.nb.html
    Ignored:    analysis/01_classification-tidymodels_cache/
    Ignored:    analysis/02_tidymodels-tidy-machine-learning_cache/

</code></pre>
<p>
Note that any generated files, e.g. HTML, png, CSS, etc., are not
included in this status report because it is ok for generated content to
have uncommitted changes.
</p>
</div>
</div>
</div>
</div>
<hr>
</div>
<div id="versions" class="tab-pane fade">

<p>
These are the previous versions of the repository in which changes were
made to the R Markdown
(<code>analysis/02_tidymodels-tidy-machine-learning.Rmd</code>) and HTML
(<code>docs/02_tidymodels-tidy-machine-learning.html</code>) files. If
you’ve configured a remote Git repository (see
<code>?wflow_git_remote</code>), click on the hyperlinks in the table
below to view the files as they were in that past version.
</p>
<div class="table-responsive">
<table class="table table-condensed table-hover">
<thead>
<tr>
<th>
File
</th>
<th>
Version
</th>
<th>
Author
</th>
<th>
Date
</th>
<th>
Message
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/ogorodriguez/013_tidymodels-practice-various/blob/7c15045931b33f08d6c3ea20f4902e76273d208e/analysis/02_tidymodels-tidy-machine-learning.Rmd" target="_blank">7c15045</a>
</td>
<td>
ogorodriguez
</td>
<td>
2023-01-29
</td>
<td>
Added workflow and parameter tuning section
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/ogorodriguez/013_tidymodels-practice-various/ef73acd82895fff3e2178b463f4a124700030c97/docs/02_tidymodels-tidy-machine-learning.html" target="_blank">ef73acd</a>
</td>
<td>
ogorodriguez
</td>
<td>
2023-01-29
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/ogorodriguez/013_tidymodels-practice-various/blob/3e2cb504f554d41f87ed56981be69800ceaae9c5/analysis/02_tidymodels-tidy-machine-learning.Rmd" target="_blank">3e2cb50</a>
</td>
<td>
ogorodriguez
</td>
<td>
2023-01-29
</td>
<td>
Publshing revised
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/ogorodriguez/013_tidymodels-practice-various/449d4969bf495b420330ddf8420286baf7020dcf/docs/02_tidymodels-tidy-machine-learning.html" target="_blank">449d496</a>
</td>
<td>
ogorodriguez
</td>
<td>
2023-01-21
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/ogorodriguez/013_tidymodels-practice-various/blob/999008cffcc280276ebaca23d2b8dbad3f9c4ce8/analysis/02_tidymodels-tidy-machine-learning.Rmd" target="_blank">999008c</a>
</td>
<td>
ogorodriguez
</td>
<td>
2023-01-21
</td>
<td>
Added the recipes and parsnip sections
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/ogorodriguez/013_tidymodels-practice-various/c40832a84b49606c3cbd0093f93107c3cb84cd3e/docs/02_tidymodels-tidy-machine-learning.html" target="_blank">c40832a</a>
</td>
<td>
ogorodriguez
</td>
<td>
2023-01-21
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/ogorodriguez/013_tidymodels-practice-various/blob/dc7be43c8bdb14a293867a5e16426f1d0e91c142/analysis/02_tidymodels-tidy-machine-learning.Rmd" target="_blank">dc7be43</a>
</td>
<td>
ogorodriguez
</td>
<td>
2023-01-21
</td>
<td>
Publish without cache
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/ogorodriguez/013_tidymodels-practice-various/ea7c13e13f3472e832fabf1662e9d0d6b27c193c/docs/02_tidymodels-tidy-machine-learning.html" target="_blank">ea7c13e</a>
</td>
<td>
ogorodriguez
</td>
<td>
2023-01-21
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/ogorodriguez/013_tidymodels-practice-various/blob/269b2781ee44be20a7865721037d7ded11d1fa7c/analysis/02_tidymodels-tidy-machine-learning.Rmd" target="_blank">269b278</a>
</td>
<td>
ogorodriguez
</td>
<td>
2023-01-21
</td>
<td>
Republish to refresh message and check
</td>
</tr>
<tr>
<td>
html
</td>
<td>
<a href="https://rawcdn.githack.com/ogorodriguez/013_tidymodels-practice-various/3512bf001196c92846ad1e5c233ff5873f41d711/docs/02_tidymodels-tidy-machine-learning.html" target="_blank">3512bf0</a>
</td>
<td>
ogorodriguez
</td>
<td>
2023-01-21
</td>
<td>
Build site.
</td>
</tr>
<tr>
<td>
Rmd
</td>
<td>
<a href="https://github.com/ogorodriguez/013_tidymodels-practice-various/blob/e6bedd89e8d6de6253a10f33e4e20d975a2ee018/analysis/02_tidymodels-tidy-machine-learning.Rmd" target="_blank">e6bedd8</a>
</td>
<td>
ogorodriguez
</td>
<td>
2023-01-21
</td>
<td>
Started tidymodels notebook from Rebecca
</td>
</tr>
</tbody>
</table>
</div>
<hr>
</div>
</div>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>In this notebook I will review the website from Rebecca Barter on
<code>tidymodels.</code> I have learned purrr, and dplyr with this
person’s website before. It excels in explaining R packages and their
concepts in simple ways.</p>
<p><a
href="https://www.rebeccabarter.com/blog/2020-03-25_machine_learning/">Rebecca
Barter’s post on Tidymodels</a></p>
<p>She already tried to learn the <code>caret</code> package. This
package was the inception of <code>tidymodels</code> creator, Max Kuhn.
The objective was to create a unifed interface to perform machine
learing in R.</p>
<p><code>caret</code> was not a tidy package. <code>tidymodels</code>
has resolved that and it will subsitute other previous package.</p>
<p>Rebecca bases her study to learn <code>tidymodels</code> from the
following sources:</p>
<ul>
<li><a
href="https://education.rstudio.com/blog/2020/02/conf20-intro-ml/">Introduction
to Maching Learning with the tidyverse</a></li>
<li><a
href="https://education.rstudio.com/blog/2020/02/conf20-intro-ml/">A
Gentle introduction to tidymodels</a></li>
</ul>
<p>Sources that I will include in this learning phase.</p>
</div>
<div id="what-is-tidymodels" class="section level2">
<h2>What is tidymodels?</h2>
<p><code>Tidymodels</code> consists of several packages, just like
<code>tidyverse</code>. These packages include:</p>
<ul>
<li><code>rsample</code> for sample splitting to get train, test and
cross-validation data</li>
<li><code>recipes</code> for pre-processing</li>
<li><code>parsnip</code> for specifying the model</li>
<li><code>yardstick</code> for evaluation the model</li>
</ul>
<p>and there are <a href="https://www.tidymodels.org/packages/">many
more</a>. The suite can be loaded into R.<br />
The author will add other packages for tuning parameter,
<code>tune</code>, and <code>workflows</code> for putting it all
together.</p>
</div>
<div id="setting-up-the-work" class="section level2">
<h2>Setting up the work</h2>
<p>For the data to use in this notebook, we’ll load the package
<code>mlbench</code>. This contains the data on Pima Indian
Diabetes.</p>
<pre class="r"><code># Load the tidymodels and other packages
# tidymodels and tidyverse loaded at start
# From mlbench, we get the dataset to work with
pacman::p_load(workflows,
               tune,
               mlbench)</code></pre>
<div id="the-dataset" class="section level3">
<h3>The dataset</h3>
<p>The data set to use is Pima Indian Women’s diabetes. This dataset is
from the National Institute of Diabeter, Digestive, and Kidney Diseases.
It contains information on 768 indian women from Phoenix, Arizona,
USA.</p>
<p>Interestingly, these indian people are called “Pima” because that is
the word they used when interacting with Spaish colinists a lot. “Pima”
is believed to mean “I don’t know!”</p>
<p>The dataset include a number of prediction variables such as number
of pregnancies, BMI, age, diabetes pedigree, etc.</p>
<pre class="r"><code>data(&quot;PimaIndiansDiabetes&quot;)

diabetes_orig &lt;- PimaIndiansDiabetes

diabetes_orig %&gt;% 
  glimpse()</code></pre>
<pre><code>Rows: 768
Columns: 9
$ pregnant &lt;dbl&gt; 6, 1, 8, 1, 0, 5, 3, 10, 2, 8, 4, 10, 10, 1, 5, 7, 0, 7, 1, 1…
$ glucose  &lt;dbl&gt; 148, 85, 183, 89, 137, 116, 78, 115, 197, 125, 110, 168, 139,…
$ pressure &lt;dbl&gt; 72, 66, 64, 66, 40, 74, 50, 0, 70, 96, 92, 74, 80, 60, 72, 0,…
$ triceps  &lt;dbl&gt; 35, 29, 0, 23, 35, 0, 32, 0, 45, 0, 0, 0, 0, 23, 19, 0, 47, 0…
$ insulin  &lt;dbl&gt; 0, 0, 0, 94, 168, 0, 88, 0, 543, 0, 0, 0, 0, 846, 175, 0, 230…
$ mass     &lt;dbl&gt; 33.6, 26.6, 23.3, 28.1, 43.1, 25.6, 31.0, 35.3, 30.5, 0.0, 37…
$ pedigree &lt;dbl&gt; 0.627, 0.351, 0.672, 0.167, 2.288, 0.201, 0.248, 0.134, 0.158…
$ age      &lt;dbl&gt; 50, 31, 32, 21, 33, 30, 26, 29, 53, 54, 30, 34, 57, 59, 51, 3…
$ diabetes &lt;fct&gt; pos, neg, pos, neg, pos, neg, pos, neg, pos, pos, neg, pos, n…</code></pre>
<pre class="r"><code>diabetes_orig %&gt;% 
  dplyr::slice_sample(n = 10)</code></pre>
<pre><code>    pregnant glucose pressure triceps insulin mass pedigree age diabetes
166        6     104       74      18     156 29.9    0.722  41      pos
60         0     105       64      41     142 41.5    0.173  22      neg
234        4     122       68       0       0 35.0    0.394  29      neg
113        1      89       76      34      37 31.2    0.192  23      neg
99         6      93       50      30      64 28.7    0.356  23      neg
350        5       0       80      32       0 41.0    0.346  37      pos
259        1     193       50      16     375 25.9    0.655  24      neg
511       12      84       72      31       0 29.7    0.297  46      pos
421        1     119       88      41     170 45.3    0.507  26      neg
716        7     187       50      33     392 33.9    0.826  34      pos</code></pre>
<pre class="r"><code>diabetes_orig %&gt;% 
  skimr::skim()</code></pre>
<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
Piped data
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
768
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:left;">
ordered
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:left;">
top_counts
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
diabetes
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
neg: 500, pos: 268
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
pregnant
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
3.85
</td>
<td style="text-align:right;">
3.37
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
3.00
</td>
<td style="text-align:right;">
6.00
</td>
<td style="text-align:right;">
17.00
</td>
<td style="text-align:left;">
▇▃▂▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
glucose
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
120.89
</td>
<td style="text-align:right;">
31.97
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
99.00
</td>
<td style="text-align:right;">
117.00
</td>
<td style="text-align:right;">
140.25
</td>
<td style="text-align:right;">
199.00
</td>
<td style="text-align:left;">
▁▁▇▆▂
</td>
</tr>
<tr>
<td style="text-align:left;">
pressure
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
69.11
</td>
<td style="text-align:right;">
19.36
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
62.00
</td>
<td style="text-align:right;">
72.00
</td>
<td style="text-align:right;">
80.00
</td>
<td style="text-align:right;">
122.00
</td>
<td style="text-align:left;">
▁▁▇▇▁
</td>
</tr>
<tr>
<td style="text-align:left;">
triceps
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
20.54
</td>
<td style="text-align:right;">
15.95
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
23.00
</td>
<td style="text-align:right;">
32.00
</td>
<td style="text-align:right;">
99.00
</td>
<td style="text-align:left;">
▇▇▂▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
insulin
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
79.80
</td>
<td style="text-align:right;">
115.24
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
30.50
</td>
<td style="text-align:right;">
127.25
</td>
<td style="text-align:right;">
846.00
</td>
<td style="text-align:left;">
▇▁▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
mass
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
31.99
</td>
<td style="text-align:right;">
7.88
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
27.30
</td>
<td style="text-align:right;">
32.00
</td>
<td style="text-align:right;">
36.60
</td>
<td style="text-align:right;">
67.10
</td>
<td style="text-align:left;">
▁▃▇▂▁
</td>
</tr>
<tr>
<td style="text-align:left;">
pedigree
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
0.37
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
2.42
</td>
<td style="text-align:left;">
▇▃▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
33.24
</td>
<td style="text-align:right;">
11.76
</td>
<td style="text-align:right;">
21.00
</td>
<td style="text-align:right;">
24.00
</td>
<td style="text-align:right;">
29.00
</td>
<td style="text-align:right;">
41.00
</td>
<td style="text-align:right;">
81.00
</td>
<td style="text-align:left;">
▇▃▁▁▁
</td>
</tr>
</tbody>
</table>
<p>This dataset contains lots of 0’s in sections where it is not
plausible (BMI for instance.) This can be attributed to missing values
in the dataset.</p>
<p>Let’s check the tricep skin fold variable distribution, and the BMI
distribution to check the shape of the dataset.</p>
<pre class="r"><code>diabetes_orig %&gt;% 
  ggplot() +
    geom_histogram(aes(x = triceps))</code></pre>
<p><img src="figure/02_tidymodels-tidy-machine-learning.Rmd/checking%20distibution%20of%20variable%20tricep-1.png" width="1440" style="display: block; margin: auto;" /></p>
<pre class="r"><code>diabetes_orig %&gt;% 
  ggplot() +
    geom_histogram(aes(x = mass))</code></pre>
<p><img src="figure/02_tidymodels-tidy-machine-learning.Rmd/checking%20distibution%20of%20variable%20mass-1.png" width="1440" style="display: block; margin: auto;" /></p>
<p>We can definitely see the values marked as 0, so far from the
distribution of data. It can also be seen in other variables as
well.</p>
<p>For this we will do a transformation of the dataset so that all 0’s
become NAs</p>
<pre class="r"><code>diabetes_clean &lt;- diabetes_orig %&gt;% 
  mutate(across(c(triceps, glucose, pressure, insulin, mass),
         function(.x) {
           case_when(
             .x == 0 ~ as.numeric(NA),  # if the entry is 0, replace it for NA
             TRUE ~ .x)                 # otherwise leave it as it is
         }))

diabetes_clean %&gt;% 
  dplyr::slice_sample(n = 10)</code></pre>
<pre><code>    pregnant glucose pressure triceps insulin mass pedigree age diabetes
746       12     100       84      33     105 30.0    0.488  46      neg
369        3      81       86      16      66 27.5    0.306  22      neg
151        1     136       74      50     204 37.4    0.399  24      neg
422        2      94       68      18      76 26.0    0.561  21      neg
358       13     129       NA      30      NA 39.9    0.569  44      pos
169        4     110       66      NA      NA 31.9    0.471  29      neg
258        2     114       68      22      NA 28.7    0.092  25      neg
231        4     142       86      NA      NA 44.0    0.645  22      pos
459       10     148       84      48     237 37.6    1.001  51      pos
522        3     124       80      33     130 33.2    0.305  26      neg</code></pre>
<p>Now let’s check our new clean dataset summary.</p>
<pre class="r"><code>diabetes_clean %&gt;% 
  skim()</code></pre>
<table style="width: auto;" class="table table-condensed">
<caption>
Data summary
</caption>
<tbody>
<tr>
<td style="text-align:left;">
Name
</td>
<td style="text-align:left;">
Piped data
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of rows
</td>
<td style="text-align:left;">
768
</td>
</tr>
<tr>
<td style="text-align:left;">
Number of columns
</td>
<td style="text-align:left;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
_______________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Column type frequency:
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
factor
</td>
<td style="text-align:left;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
numeric
</td>
<td style="text-align:left;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
________________________
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:left;">
Group variables
</td>
<td style="text-align:left;">
None
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: factor</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:left;">
ordered
</th>
<th style="text-align:right;">
n_unique
</th>
<th style="text-align:left;">
top_counts
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
diabetes
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:left;">
neg: 500, pos: 268
</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left;">
skim_variable
</th>
<th style="text-align:right;">
n_missing
</th>
<th style="text-align:right;">
complete_rate
</th>
<th style="text-align:right;">
mean
</th>
<th style="text-align:right;">
sd
</th>
<th style="text-align:right;">
p0
</th>
<th style="text-align:right;">
p25
</th>
<th style="text-align:right;">
p50
</th>
<th style="text-align:right;">
p75
</th>
<th style="text-align:right;">
p100
</th>
<th style="text-align:left;">
hist
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
pregnant
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
3.85
</td>
<td style="text-align:right;">
3.37
</td>
<td style="text-align:right;">
0.00
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
3.00
</td>
<td style="text-align:right;">
6.00
</td>
<td style="text-align:right;">
17.00
</td>
<td style="text-align:left;">
▇▃▂▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
glucose
</td>
<td style="text-align:right;">
5
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
121.69
</td>
<td style="text-align:right;">
30.54
</td>
<td style="text-align:right;">
44.00
</td>
<td style="text-align:right;">
99.00
</td>
<td style="text-align:right;">
117.00
</td>
<td style="text-align:right;">
141.00
</td>
<td style="text-align:right;">
199.00
</td>
<td style="text-align:left;">
▁▇▇▃▂
</td>
</tr>
<tr>
<td style="text-align:left;">
pressure
</td>
<td style="text-align:right;">
35
</td>
<td style="text-align:right;">
0.95
</td>
<td style="text-align:right;">
72.41
</td>
<td style="text-align:right;">
12.38
</td>
<td style="text-align:right;">
24.00
</td>
<td style="text-align:right;">
64.00
</td>
<td style="text-align:right;">
72.00
</td>
<td style="text-align:right;">
80.00
</td>
<td style="text-align:right;">
122.00
</td>
<td style="text-align:left;">
▁▃▇▂▁
</td>
</tr>
<tr>
<td style="text-align:left;">
triceps
</td>
<td style="text-align:right;">
227
</td>
<td style="text-align:right;">
0.70
</td>
<td style="text-align:right;">
29.15
</td>
<td style="text-align:right;">
10.48
</td>
<td style="text-align:right;">
7.00
</td>
<td style="text-align:right;">
22.00
</td>
<td style="text-align:right;">
29.00
</td>
<td style="text-align:right;">
36.00
</td>
<td style="text-align:right;">
99.00
</td>
<td style="text-align:left;">
▆▇▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
insulin
</td>
<td style="text-align:right;">
374
</td>
<td style="text-align:right;">
0.51
</td>
<td style="text-align:right;">
155.55
</td>
<td style="text-align:right;">
118.78
</td>
<td style="text-align:right;">
14.00
</td>
<td style="text-align:right;">
76.25
</td>
<td style="text-align:right;">
125.00
</td>
<td style="text-align:right;">
190.00
</td>
<td style="text-align:right;">
846.00
</td>
<td style="text-align:left;">
▇▂▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
mass
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
0.99
</td>
<td style="text-align:right;">
32.46
</td>
<td style="text-align:right;">
6.92
</td>
<td style="text-align:right;">
18.20
</td>
<td style="text-align:right;">
27.50
</td>
<td style="text-align:right;">
32.30
</td>
<td style="text-align:right;">
36.60
</td>
<td style="text-align:right;">
67.10
</td>
<td style="text-align:left;">
▅▇▃▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
pedigree
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
0.47
</td>
<td style="text-align:right;">
0.33
</td>
<td style="text-align:right;">
0.08
</td>
<td style="text-align:right;">
0.24
</td>
<td style="text-align:right;">
0.37
</td>
<td style="text-align:right;">
0.63
</td>
<td style="text-align:right;">
2.42
</td>
<td style="text-align:left;">
▇▃▁▁▁
</td>
</tr>
<tr>
<td style="text-align:left;">
age
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1.00
</td>
<td style="text-align:right;">
33.24
</td>
<td style="text-align:right;">
11.76
</td>
<td style="text-align:right;">
21.00
</td>
<td style="text-align:right;">
24.00
</td>
<td style="text-align:right;">
29.00
</td>
<td style="text-align:right;">
41.00
</td>
<td style="text-align:right;">
81.00
</td>
<td style="text-align:left;">
▇▃▁▁▁
</td>
</tr>
</tbody>
</table>
<pre class="r"><code>diabetes_clean %&gt;%
  glimpse()</code></pre>
<pre><code>Rows: 768
Columns: 9
$ pregnant &lt;dbl&gt; 6, 1, 8, 1, 0, 5, 3, 10, 2, 8, 4, 10, 10, 1, 5, 7, 0, 7, 1, 1…
$ glucose  &lt;dbl&gt; 148, 85, 183, 89, 137, 116, 78, 115, 197, 125, 110, 168, 139,…
$ pressure &lt;dbl&gt; 72, 66, 64, 66, 40, 74, 50, NA, 70, 96, 92, 74, 80, 60, 72, N…
$ triceps  &lt;dbl&gt; 35, 29, NA, 23, 35, NA, 32, NA, 45, NA, NA, NA, NA, 23, 19, N…
$ insulin  &lt;dbl&gt; NA, NA, NA, 94, 168, NA, 88, NA, 543, NA, NA, NA, NA, 846, 17…
$ mass     &lt;dbl&gt; 33.6, 26.6, 23.3, 28.1, 43.1, 25.6, 31.0, 35.3, 30.5, NA, 37.…
$ pedigree &lt;dbl&gt; 0.627, 0.351, 0.672, 0.167, 2.288, 0.201, 0.248, 0.134, 0.158…
$ age      &lt;dbl&gt; 50, 31, 32, 21, 33, 30, 26, 29, 53, 54, 30, 34, 57, 59, 51, 3…
$ diabetes &lt;fct&gt; pos, neg, pos, neg, pos, neg, pos, neg, pos, pos, neg, pos, n…</code></pre>
<p>Once our data is hopefully clean, we can now start doing our machine
learning analysis with the tidymodels package.</p>
</div>
</div>
<div id="tidymodels-process" class="section level2">
<h2>Tidymodels Process</h2>
<div id="splitting-the-data-traintest" class="section level3">
<h3>Splitting the data: train/test</h3>
<p>To do a model we need to separate the dataset into parts: one for
training the model (or models), one for validating the good model (when
training on many different models to see which one is best,) and one for
testing whether the model we validated is actually the good one.</p>
<p>The training data is used to fit our model and tune its parameters,
the testing data is used to evaluate our final model’s performance.</p>
<p>The <code>rsample</code> package is used to create these split
objects.</p>
<pre class="r"><code>set.seed(234589)
# split the data into training (75%) and testing (25%)
diabetes_split &lt;- rsample::initial_split(diabetes_clean,
                                         prop = 3/4)

diabetes_split</code></pre>
<pre><code>&lt;Training/Testing/Total&gt;
&lt;576/192/768&gt;</code></pre>
<p>The training output above is telling us that we have split the set
into two groups: a. The training set has 576 observations b. The testing
set has 192 observations c. The last number is the number of
observations overall: 768</p>
<p>The training and testing sets can be extracted from the split object
using the corresponding functions <code>training()</code>, and
<code>testing()</code></p>
<pre class="r"><code># extract training and testing sets
diabetes_train &lt;- training(diabetes_split)
diabetes_test &lt;- testing(diabetes_split)</code></pre>
<p>For parameter tuning, we will need to have various versions of the
training set. It helps to create a cross-validation version of the
training set using the <code>vfold_cv()</code> function.</p>
<pre class="r"><code># creating CV object from training data
diabetes_cv &lt;- rsample::vfold_cv(diabetes_train)</code></pre>
</div>
<div id="defining-a-recipe" class="section level3">
<h3>Defining a recipe</h3>
<p>Recipes allows you to specify the formula to apply to the predictor
variables to build the desire model. It allows you to accommodate or
revise those variables of that formula prior to the execution of the
model itself (this is called pre-processing.)</p>
<p>There various pre-processing steps that can be done to our variables.
Some of them are: normalization, imputation, PCA, etc. There are many
many pre-processing steps. Their selection will depend on the variables
we have on our set.</p>
<p>The list of pre-processing steps can be found here: link needed.</p>
<p>The formula usually has the format of outcome = f(predictors).</p>
<p>In our dataset the outcome is to determine whether the patients has
diabetes based on the observations collected, but more importantly, is
to determine whether these observations are the indicated ones to
predict such an outcome, how reliable are they to get a diabetes
diagnosis.</p>
<p>Creating a recipe then has two parts layered one on top of the other
by using the pipe.</p>
<ol style="list-style-type: decimal">
<li><p>First we specify the formula using the <code>recipe()</code>
function, to specify which one is the outcome variable and which
variables to use as predictors to create our formula. In this case, we
will use them all.</p></li>
<li><p>Specify the pre-processing steps to do the the predictor
variables. Other cases of pre-processing may be scaling, creating dummy
variables, etc.</p></li>
</ol>
<p>In this occasion we will do the following:</p>
<pre class="r"><code># define the recipe
diabetes_recipe &lt;-
  recipe(diabetes ~ .,                 # the formula outcome is diabetes and the &quot;.&quot; is used to state that the rest of the columns will be the predictors.
  data = diabetes_clean) %&gt;% 
  step_normalize(all_numeric()) %&gt;%    # pre-processing step to make all predictors numeric
  step_impute_knn(all_predictors())    # pre-processing step to make impute the knn to all other columns</code></pre>
<p>The steps used here to preprocess the data are called “Role
selections”. They specify that we want to apply the step to all numeric
variables and all predictor variables. Check <code>?selections</code> to
see other examples.</p>
<p>For detailed information on normalizing data and why it is useful, <a
href="https://machinelearningmastery.com/using-normalization-layers-to-improve-deep-learning-models/">please
see here</a>. In short, normalization makes our data centered and
scaled. Centered refers to fact that our data will have a mean of 0 and
a standard deviation of 1.</p>
<p>For detailed information on the Knn (K-nearest neighbor imputation),
please <a
href="https://machinelearningmastery.com/knn-imputation-for-missing-values-in-machine-learning/">click
here.</a> In short, this is used when the dataset has lots of missing
values, and we need to impute an estimated numeric value based on the
values of nearby observations.</p>
<p>The dataset used to create the recipe was
<code>diabetes_clean</code>, our working full dataset. Any of the other
sets: the training, or split object could have been used as well.<br />
It doesn’t matter what is used. All the recipe takes from the data at
this point is the <em>names and roles</em> of the outcome and
predictors. Once the recipe is defined, it can then be applied to
specific dataset later.</p>
<p>For larger datasets, the head of the data can then be used to pass
the recipe to smaller dataset to save time and memory.</p>
<p>If we print on the console the diabetes_recipe object, it will only
show how many variables we have used as outcome and how many as
predictors. It will also show us the pre-processing steps applied.</p>
<pre class="r"><code>diabetes_recipe</code></pre>
<pre><code>Recipe

Inputs:

      role #variables
   outcome          1
 predictor          8

Operations:

Centering and scaling for all_numeric()
K-nearest neighbor imputation for all_predictors()</code></pre>
<p>As indicated before, the recipe was a apply to a dataset only to
identify which variable is the outcome, which will be used as
predictors, and which steps are needed to make the predictors ready for
analysis. Now, if we want to apply the recipe to another data set (the
training, or testing, etc.) we need to use other functions.</p>
<ol style="list-style-type: lower-alpha">
<li><code>prep()</code> will apply the recipe to the new dataset</li>
<li><code>juice()</code> will extract the pre-processed data. Meaning,
it will show us how our dataset will look after the application of the
recipe steps.</li>
</ol>
<pre class="r"><code>diabetes_train_preprocessed &lt;- 
  diabetes_recipe %&gt;% 
  prep(diabetes_train) %&gt;% 
  juice()                      # This step is optional.

diabetes_train_preprocessed %&gt;% 
  dplyr::slice_sample(n = 10)</code></pre>
<pre><code># A tibble: 10 × 9
   pregnant glucose pressure triceps  insulin    mass pedigree    age diabetes
      &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;   
 1  -1.14   -0.521     1.40  -0.183  -0.239   -0.412    -0.822  1.05  neg     
 2  -0.548   0.0365   -1.68   1.26    0.0429   0.537     1.03  -0.451 neg     
 3   0.0447  0.693     1.07   0.521   0.854    1.66      0.517 -0.953 pos     
 4  -0.251  -0.817    -1.36   0.428  -0.309   -1.12      1.41   0.468 neg     
 5  -0.844   0.168    -1.36  -0.0348 -0.00626 -0.541     0.983 -1.04  neg     
 6  -0.251  -1.41     -1.84   0.243  -0.530   -0.211    -0.669 -0.618 pos     
 7   0.637   1.09      0.100  0.243   0.330   -0.455     1.10   0.468 neg     
 8   0.933  -0.226    -0.548  0.762  -0.373    0.0482   -0.639  0.719 pos     
 9  -0.251   1.38     -0.224 -1.05   -0.391   -0.124    -0.610 -0.451 pos     
10   0.637   2.04      1.72  -0.276   0.171    1.20      2.95   0.969 neg     </code></pre>
<p>Some considerations. Extracting the pre-processed data with
<code>juice()</code> is not necessary since the prepped dataset will
carry it during the machine learning process. It is used under the
hood.</p>
<p>With this done then, we can now specify which model to use for our
machine learning analysis.</p>
</div>
<div id="specifying-the-model" class="section level3">
<h3>Specifying the model</h3>
<p>After splitting the data into training and testing, identifying
outcome and predictors and knowing which steps to do pre-process our
data, and getting a pre-process dataset for that, now it is time to
specify which model will help us get the prediction of diabetes using
the predictors indicated.</p>
<p>For that the <code>parsnip</code> package aids in providing a unified
interface for the long list of models available in R.<br />
With one way to specify a model, we can then use this specification to
generate be it a linear model, a regression model, a random forest
model, or support vector machine (SVM), etc.</p>
<p>The full list of models can be searched in <a
href="https://www.tidymodels.org/find/parsnip/">the tidymodels
website.</a></p>
<p>Some primary components will need to be taken into consideration when
specifying a model.</p>
<ol style="list-style-type: lower-alpha">
<li>The <strong>model type</strong>, which requires to specify the model
we will use, for example, a random forest, or logistic regression,
etc.</li>
<li>The <strong>arguments</strong> or parameters to use within the model
specified and that are consistent across different models. Set using
<code>set_args()</code></li>
<li>The <strong>engine</strong> or underlying package where the model
comes from (e.g. “ranger” for the range implemenation of Random Forest)
using the <code>set_engine()</code> function.</li>
<li>The <strong>mode</strong> refers to the type of prediction since
many packages can do both classification (binary or categorical) or
regression (continous prediction), set using
<code>set_mode()</code></li>
</ol>
<p>In this notebook,the model type used can be the Random Forest for the
purpose of classification. The argument for this will be
<code>mtry</code> parameter to help us get the number of randomly
selected variables to be considered at each split in the trees. Then, we
we would define the following model specification:</p>
<pre class="r"><code>rf_model &lt;- 
  parsnip::rand_forest() %&gt;%                                   # specify that the model is random forest
  parsnip::set_args(mtry = tune()) %&gt;%                         # specify that the `mtry` parameter needs to be tuned
  parsnip::set_engine(&quot;ranger&quot;, importance = &quot;impurity&quot;) %&gt;%   # select the engine/package that underlies the model
  parsnip::set_mode(&quot;classification&quot;)                          # choose either binary classification or continous regression</code></pre>
<p>For examining the importance of the variables in the final model, we
need to add the <code>importance</code> argument. In the “ranger”
package the options for this argument are “impurity” an
“permutation”</p>
<p>For instance, if instead of using a Random Forest model, we would
like to specify a Logistic regression model, we could do the
following:</p>
<pre class="r"><code>lr_model &lt;- 
  parsnip::logistic_reg() %&gt;%              # specify that the model is linear regression
  parsnip::set_engine(&quot;glm&quot;) %&gt;%           # select the engine/package is &quot;glm&quot;.  No set_args() needed
  parsnip::set_mode(&quot;classification&quot;)      # choose either binary classification or continuous regression</code></pre>
<p>As can be seen in the last 2 specifications, no dataset has been
passed as argument. Which means that we are only building the framework
to be applied, not the actual analysis itself.<br />
In other words, we are not fitting any model yet since no data has been
passed on to it. Nothing in these models is specific to the diabetes
dataset.</p>
<p>These models could be defined way ahead of time to save time.</p>
<p>This just outlines a description of the model. Also, setting a
parameter to <code>tune()</code> means that it will be tuned later so
that the parameter that yield the best performance will be chosen.</p>
</div>
</div>
<div id="putting-it-all-together-the-workflow" class="section level2">
<h2>Putting it all together: The Workflow</h2>
<p>After having gone through the previous steps, defining the recipes
and model, we are now ready to put this into a one workflow. Using the
<code>workflows</code> package.</p>
<p>First, the workflow needs to be initiated. After that we can then
pass, or add, the corresponding recipe and model to it.</p>
<pre class="r"><code># setting the workflow for the random forest model
rf_workflow &lt;- workflows::workflow() %&gt;% 
  workflows::add_recipe(diabetes_recipe) %&gt;%     # add the recipe
  workflows::add_model(rf_model)                 # add the model</code></pre>
<p>Important to notice that we haven’t implemented any pre-processing
step in the recipe nor have we fit the model to the data yet. Again
we’re just writing the framework here.<br />
It is only when tuning parameters or actually passing the model to fit
that we will be indeed implementing the recipe and model framework
defined by the workflow.</p>
<p>If we take a look at the <code>rf_workflow</code> object we will see
only the structure of such framework.</p>
<pre class="r"><code>rf_workflow </code></pre>
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
2 Recipe Steps

• step_normalize()
• step_impute_knn()

── Model ───────────────────────────────────────────────────────────────────────
Random Forest Model Specification (classification)

Main Arguments:
  mtry = tune()

Engine-Specific Arguments:
  importance = impurity

Computational engine: ranger </code></pre>
<div id="tuning-the-parameters" class="section level3">
<h3>Tuning the parameters</h3>
<p>In case we have parameters, these need to be tuned. Tuning means
choosing the value that leads to the best performance of our model. If
our model does not have parameters, this step can be skipped.</p>
<p>For our Random Forest model, the parameter we chose to tune was mtry.
Mtry helps include a randomness in the choosing of the features to use
to create the decission trees of our model. A big number of features
will lead to having the decisions tress look the same, and a very small
number may ignore key features that impact our outcome variable. Mtry is
explained in very fine detail <a
href="https://crunchingthedata.com/mtry-in-random-forests/">in this blog
article.</a></p>
<p>To obtain the value of mtry that we will use in our model/workflow,
we will use the cross-validation dataset <code>diabetes_cv</code> we
created earlier. The cross-validation data has lots of versions of our
original dataset that we can use to create our trees.</p>
<p>We first specify the values of mtry we want to try. We have in total
9 features (or variables or columns ) in our dataset. In this article,
the author used three possible numbers for mtry: 3, 4, 5.</p>
<p>Then we will try to get the metrics: <a
href="https://medium.com/nerd-for-tech/accuracy-vs-auc-roc-a8e7a384d153">accuracy,
and roc_auc</a>.</p>
<pre class="r"><code>rf_grid &lt;- expand.grid(mtry = c(3, 4, 5))             # specify the values of mtry to try
rf_tune_results &lt;- rf_workflow %&gt;% 
  tune_grid(resamples = diabetes_cv,                  # The cross-validation object
            grid = rf_grid,                           # grid with values to try
            metrics = metric_set(accuracy, roc_auc)   # metrics we care about 
            )</code></pre>
<pre><code>Warning: package &#39;ranger&#39; was built under R version 4.2.2</code></pre>
<p>It is a good idea to explore the results of the
cross-validation.<br />
Using <code>collect_metrics()</code> from the <code>yardstick</code>
package can be used to extract the values of the metrics we input in the
tuning phase (accuracy and roc_auc)</p>
<pre class="r"><code>rf_tune_results %&gt;% 
  collect_metrics()</code></pre>
<pre><code># A tibble: 6 × 7
   mtry .metric  .estimator  mean     n std_err .config             
  &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1     3 accuracy binary     0.766    10  0.0128 Preprocessor1_Model1
2     3 roc_auc  binary     0.841    10  0.0127 Preprocessor1_Model1
3     4 accuracy binary     0.760    10  0.0128 Preprocessor1_Model2
4     4 roc_auc  binary     0.843    10  0.0120 Preprocessor1_Model2
5     5 accuracy binary     0.768    10  0.0127 Preprocessor1_Model3
6     5 roc_auc  binary     0.838    10  0.0126 Preprocessor1_Model3</code></pre>
<p>According to the author, with <code>mtry = 4</code> we get the best
performance (<em>just</em>)</p>
</div>
<div id="finalize-the-workflow" class="section level3">
<h3>Finalize the workflow</h3>
<p>Now that the mtry parameter has been tuned. We need to add this into
our workflow so it chooses the best performing value. The function
<code>select_best()</code> will do the tuning for us and select the most
performing value.</p>
<pre class="r"><code>param_final &lt;- rf_tune_results %&gt;% 
  select_best(metric = &quot;accuracy&quot;)

param_final</code></pre>
<pre><code># A tibble: 1 × 2
   mtry .config             
  &lt;dbl&gt; &lt;chr&gt;               
1     5 Preprocessor1_Model3</code></pre>
<p>Then we add this final parameter to have our final workflow to use to
fit the dataset</p>
<pre class="r"><code>rf_final_workflow &lt;- rf_workflow %&gt;% 
  finalize_workflow(param_final)

rf_final_workflow</code></pre>
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: rand_forest()

── Preprocessor ────────────────────────────────────────────────────────────────
2 Recipe Steps

• step_normalize()
• step_impute_knn()

── Model ───────────────────────────────────────────────────────────────────────
Random Forest Model Specification (classification)

Main Arguments:
  mtry = 5

Engine-Specific Arguments:
  importance = impurity

Computational engine: ranger </code></pre>
<br>
<p>
<button type="button" class="btn btn-default btn-workflowr btn-workflowr-sessioninfo" data-toggle="collapse" data-target="#workflowr-sessioninfo" style="display: block;">
<span class="glyphicon glyphicon-wrench" aria-hidden="true"></span>
Session information
</button>
</p>
<div id="workflowr-sessioninfo" class="collapse">
<pre class="r"><code>sessionInfo()</code></pre>
<pre><code>R version 4.2.1 (2022-06-23 ucrt)
Platform: x86_64-w64-mingw32/x64 (64-bit)
Running under: Windows 10 x64 (build 19045)

Matrix products: default

locale:
[1] LC_COLLATE=Spanish_Spain.utf8  LC_CTYPE=Spanish_Spain.utf8   
[3] LC_MONETARY=Spanish_Spain.utf8 LC_NUMERIC=C                  
[5] LC_TIME=Spanish_Spain.utf8    

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] ranger_0.14.1        mlbench_2.1-3        skimr_2.1.5         
 [4] yardstick_1.0.0      workflowsets_1.0.0   workflows_1.0.0     
 [7] tune_1.0.0           rsample_1.1.0        recipes_1.0.1       
[10] parsnip_1.0.1        modeldata_1.0.1.9000 infer_1.0.3         
[13] dials_1.0.0          scales_1.2.1         broom_1.0.1         
[16] tidymodels_1.0.0     kableExtra_1.3.4     readxl_1.4.1        
[19] here_1.0.1           janitor_2.1.0        forcats_0.5.2       
[22] stringr_1.5.0        dplyr_1.0.10         purrr_0.3.4         
[25] readr_2.1.2          tidyr_1.2.0          tibble_3.1.8        
[28] ggplot2_3.3.6        tidyverse_1.3.2      workflowr_1.7.0     

loaded via a namespace (and not attached):
  [1] backports_1.4.1     systemfonts_1.0.4   repr_1.1.4         
  [4] splines_4.2.1       listenv_0.8.0       digest_0.6.29      
  [7] foreach_1.5.2       htmltools_0.5.3     fansi_1.0.3        
 [10] magrittr_2.0.3      googlesheets4_1.0.1 tzdb_0.3.0         
 [13] globals_0.16.1      modelr_0.1.9        gower_1.0.0        
 [16] svglite_2.1.0       hardhat_1.2.0       timechange_0.1.1   
 [19] colorspace_2.0-3    rvest_1.0.3         haven_2.5.1        
 [22] xfun_0.35           callr_3.7.2         crayon_1.5.2       
 [25] jsonlite_1.8.3      survival_3.3-1      iterators_1.0.14   
 [28] glue_1.6.2          gtable_0.3.1        gargle_1.2.0       
 [31] ipred_0.9-13        webshot_0.5.4       future.apply_1.9.0 
 [34] DBI_1.1.3           Rcpp_1.0.9          viridisLite_0.4.1  
 [37] GPfit_1.0-8         lava_1.6.10         prodlim_2019.11.13 
 [40] httr_1.4.4          ellipsis_0.3.2      pkgconfig_2.0.3    
 [43] farver_2.1.1        nnet_7.3-17         sass_0.4.4         
 [46] dbplyr_2.2.1        utf8_1.2.2          tidyselect_1.2.0   
 [49] labeling_0.4.2      rlang_1.0.6         DiceDesign_1.9     
 [52] later_1.3.0         munsell_0.5.0       cellranger_1.1.0   
 [55] tools_4.2.1         cachem_1.0.6        cli_3.3.0          
 [58] generics_0.1.3      pacman_0.5.1        evaluate_0.18      
 [61] fastmap_1.1.0       yaml_2.3.5          processx_3.7.0     
 [64] knitr_1.41          fs_1.5.2            future_1.28.0      
 [67] whisker_0.4         xml2_1.3.3          compiler_4.2.1     
 [70] rstudioapi_0.14     reprex_2.0.2        lhs_1.1.5          
 [73] bslib_0.4.1         stringi_1.7.8       highr_0.9          
 [76] ps_1.7.1            lattice_0.20-45     Matrix_1.4-1       
 [79] vctrs_0.5.1         pillar_1.8.1        lifecycle_1.0.3    
 [82] furrr_0.3.1         jquerylib_0.1.4     httpuv_1.6.5       
 [85] R6_2.5.1            promises_1.2.0.1    parallelly_1.32.1  
 [88] codetools_0.2-18    MASS_7.3-57         assertthat_0.2.1   
 [91] rprojroot_2.0.3     withr_2.5.0         parallel_4.2.1     
 [94] hms_1.1.2           grid_4.2.1          rpart_4.1.16       
 [97] timeDate_4021.104   class_7.3-20        rmarkdown_2.18     
[100] snakecase_0.11.0    googledrive_2.0.0   git2r_0.30.1       
[103] getPass_0.2-2       lubridate_1.9.0     base64enc_0.1-3    </code></pre>
</div>
</div>
</div>


<!-- Adjust MathJax settings so that all math formulae are shown using
TeX fonts only; see
https://docs.mathjax.org/en/latest/web/configuration.html. This will make
the presentation more consistent at the cost of the webpage sometimes
taking slightly longer to load. Note that this only works because the
footer is added to webpages before the MathJax javascript. -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>




</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
